#include "new.ch"
FUNCTION modify2(var1)
LOCAL m_path
LOCAL s1:=LOWER(EXENAME())
IF var1==NIL
       s1:=LEFT(s1,ATTOKEN(s1,"\")-1)
       s1:=LEFT(s1,ATTOKEN(s1,"\")-1)
       m_path:=s1

ELSE
m_path:=alltrim(var1)
ENDIF
IF (FILE(m_path+"BH\raschet.exe"))
  m_date := FileDate(m_path+"BH\raschet.exe")
  IF m_date<>CTOD("02/02/08")
     DispError("Файл  raschet.exe не  был обновлен !!!; Обновите его обязательно")
  ENDIF
ELSE
  DispError("Файл  raschet.exe не найден в "+m_path+"BH")
  return
ENDIF
SET DELE ON
SET PRINTER TO (m_path+"ms\modify2.txt")
SET PRINTER ON
SET CONSOLE OFF
//Modifyfd1(m_path,"bf")
//Modifyfd1(m_path,"mn")
//ModifySp(m_path)
ModifySystem(m_path)
SET PRINTER TO
SET PRINTER OFF
SET CONSOLE ON

RETURN .t.
FUNCTION ModifySystem(m_path)
LOCAL m_message
m_message=DispMessage("Модификация файла memvar")
USE (m_path+"SYSTEM\memvar") INDEX (m_path+"SYSTEM\memvar") ALIAS mem NEW
REINDEX
DelMessage(m_message)
mdmemvar("ZR","x_pod","N","предел соц. льготы ",890)
mdmemvar("ZR","p_minimum","N"," прожит минимум ",633)
mdmemvar("ZR","x_strah","N"," минимум для соц.страха ",633)
mdmemvar("ZR","m_maxpredel","N"," верхний предел налогообложения ",9495)
Close mem
m_message=DispMessage("Модификация файла struct")
USE (m_path+"SYSTEM\struct") INDEX (m_path+"SYSTEM\struct") ALIAS st NEW
REINDEX
mdstruct("USCH01","TABN","C",4,0)

DelMessage(m_message)
RETURN .t.
STATIC function mdmemvar(m_prg,m_name,m_kod,m_comment,m_value) 
IF (mem->(DS(m_prg+m_kod)))
	m_val2:=TRIM(mem->value)
	IF m_val2!=m_value
		IF ANSWERu(" Заменять значение "+m_comment +"; с старого "+m_val2+"на новое" +m_value+"?")==YES
  			mem->value:=m_value
		ENDIF
	ENDIF
ELSE
	IF ANSWERu(" Добавить  значение "+m_comment +";" +m_value+"?")==YES
  		mem->(DBAP())
  		mem->prg:=m_prg
  		mem->name:=m_name
  		mem->kod:=m_kod
  		mem->value:=m_value
  		mem->comment:=m_comment
	ENDIF
ENDIF
RETURN 
STATIC function mdstruct(m_prg,m_name,m_kod,m_length,m_dec) 
IF (!st->(DS(m_prg+m_kod)))
	IF ANSWERu(" Добавить  значение "+m_prg +";" +m_name+"?")==YES
  		st->(DBAP())
  		st->name:=m_prg
  		st->field_name:=m_name
  		st->field_type:=m_kod
  		st->Field_len:=m_length
  		st->cfield_dec:=m_dec
	ENDIF
ENDIF

